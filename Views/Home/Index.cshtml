@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <button id="loadParks" class="btn btn-primary">Показати усі парки</button>
    <button id="loadPlantings" class="btn btn-primary">Показати усі насадження</button>
    <button id="loadFountains" class="btn btn-primary">Показати усі фонтани</button>
    <button id="loadPavilions" class="btn btn-primary">Показати усі павільони</button>
</div>

<div id="result" class="mt-4"></div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            function appendActionButtons(section) {
                return `
                            <div class="mt-3" id="actionButtons">
                                ${section === 'parks' ? '<button class="btn btn-success" id="addParkButton">Додати парк</button>' : ''}
                                ${section === 'plantings' ? '<button class="btn btn-success" id="addPlantingButton">Додати насадження</button>' : ''}
                                ${section === 'fountains' ? '<button class="btn btn-success" id="addFountainButton">Додати фонтан</button>' : ''}
                                ${section === 'pavilions' ? '<button class="btn btn-success" id="addPavilionButton">Додати павільон</button>' : ''}
                            </div>
                        `;
            }

            function showAddParkForm() {
                $('#addParkForm').remove();
                const formHtml = `
                            <div id="addParkForm" class="mt-3">
                                <h4>Додати парк</h4>
                                <input type="text" id="parkName" class="form-control mb-2" placeholder="Назва парку">
                                <input type="number" id="parkSquare" class="form-control mb-2" placeholder="Площа">
                                <input type="text" id="parkLocation" class="form-control mb-2" placeholder="Локація">
                                <button class="btn btn-primary" onclick="submitPark()">Зберегти</button>
                            </div>
                        `;
                $('#actionButtons').after(formHtml);
            }

            function showAddPlantingForm() {
                $('#addPlantingForm').remove();
                const formHtml = `
                            <div id="addPlantingForm" class="mt-3">
                                <h4>Додати насадження</h4>
                                <input type="number" id="parkId" class="form-control mb-2" placeholder="ID парка">
                                <input type="text" id="cultureType" class="form-control mb-2" placeholder="Тип культури">
                                <input type="text" id="plantingName" class="form-control mb-2" placeholder="Ім'я насадження">
                                <input type="number" id="averageLifetime" class="form-control mb-2" placeholder="Середня тривалість життя">
                                <input type="number" id="quantity" class="form-control mb-2" placeholder="Кількість">
                                <button class="btn btn-primary" onclick="submitPlanting()">Зберегти</button>
                            </div>
                        `;
                $('#actionButtons').after(formHtml);
            }

            function showAddFountainForm() {
                $('#addFountainForm').remove();
                const formHtml = `
                            <div id="addFountainForm" class="mt-3">
                                <h4>Додати фонтан</h4>
                                <input type="number" id="fountainParkId" class="form-control mb-2" placeholder="ID парка">
                                <input type="number" id="fountainCode" class="form-control mb-2" placeholder="Код">
                                <input type="date" id="buildDate" class="form-control mb-2" placeholder="Дата побудови">
                                <input type="number" id="maxWaterConsumption" class="form-control mb-2" placeholder="Максимальна витрата води">
                                <input type="number" id="normalWaterConsumption" class="form-control mb-2" placeholder="Нормальна витрата води">
                                <input type="number" id="fountainSquare" class="form-control mb-2" placeholder="Площа">
                                <button class="btn btn-primary" onclick="submitFountain()">Зберегти</button>
                            </div>
                        `;
                $('#actionButtons').after(formHtml);
            }

            function showAddPavilionForm() {
                $('#addPavilionForm').remove();
                const formHtml = `
                            <div id="addPavilionForm" class="mt-3">
                                <h4>Додати павільон</h4>
                                <input type="number" id="pavilionParkId" class="form-control mb-2" placeholder="ID парка">
                                <input type="text" id="pavilionName" class="form-control mb-2" placeholder="Назва павільону">
                                <input type="text" id="pavilionType" class="form-control mb-2" placeholder="Тип павільону">
                                <input type="number" id="pavilionSquare" class="form-control mb-2" placeholder="Площа">
                                <button class="btn btn-primary" onclick="submitPavilion()">Зберегти</button>
                            </div>
                        `;
                $('#actionButtons').after(formHtml);
            }

            function loadSection(section) {
                let url;
                let title;
                let loadFunction;

                switch (section) {
                    case 'parks':
                        url = '@Url.Action("GetAllParks", "Parks")';
                        title = 'Список парків';
                        loadFunction = showAddParkForm;
                        break;
                    case 'plantings':
                        url = '@Url.Action("GetAllPlantings", "Parks")';
                        title = 'Список насаджень';
                        loadFunction = showAddPlantingForm;
                        break;
                    case 'fountains':
                        url = '@Url.Action("GetAllFountains", "Parks")';
                        title = 'Список фонтанів';
                        loadFunction = showAddFountainForm;
                        break;
                    case 'pavilions':
                        url = '@Url.Action("GetAllPavilions", "Parks")';
                        title = 'Список павільонів';
                        loadFunction = showAddPavilionForm;
                        break;
                }

                $.ajax({
                    url: url,
                    type: 'GET',
                    success: function (data) {
                        let html = `<h2>${title}</h2><table class="table"><thead><tr>`;
                        // Динамічно створюємо заголовки таблиці в залежності від секції
                        if (section === 'parks') {
                            html += '<th>ID</th><th>Назва</th><th>Площа</th><th>Локація</th>';
                        } else if (section === 'plantings') {
                            html += '<th>ID</th><th>Тип культури</th><th>Ім\'я насадження</th><th>Середня тривалість життя</th><th>Кількість</th><th>Парк</th>';
                        } else if (section === 'fountains') {
                            html += '<th>ID</th><th>Код</th><th>Дата побудови</th><th>Максимальна витрата води</th><th>Нормальна витрата води</th><th>Площа</th><th>Парк</th>';
                        } else if (section === 'pavilions') {
                            html += '<th>ID</th><th>Ім\'я</th><th>Тип</th><th>Площа</th><th>Парк</th>';
                        }
                        html += '</tr></thead><tbody>';
                        $.each(data, function (index, item) {
                            html += '<tr>';
                            if (section === 'parks') {
                                html += `<td>${item.id}</td><td>${item.name}</td><td>${item.square}</td><td>${item.location}</td>`;
                                html += `<td><button class="btn btn-warning" onclick="showEditParkForm(${item.id})">Змінити</button></td>`;
                            } else if (section === 'plantings') {
                                html += `<td>${item.id}</td><td>${item.cultureType}</td><td>${item.name}</td><td>${item.averageLifetime}</td><td>${item.quantity}</td><td>${item.parkName}</td>`;
                                html += `<td><button class="btn btn-warning" onclick="showEditPlantingForm(${item.id})">Змінити</button></td>`;
                            } else if (section === 'fountains') {
                                html += `<td>${item.id}</td><td>${item.code}</td><td>${new Date(item.buildDate).toLocaleDateString()}</td><td>${item.maxWaterConsumption}</td><td>${item.normalWaterConsumption}</td><td>${item.square}</td><td>${item.parkName}</td>`;
                                html += `<td><button class="btn btn-warning" onclick="showEditParkForm(${item.id})">Змінити</button></td>`;
                            } else if (section === 'pavilions') {
                                html += `<td>${item.id}</td><td>${item.name}</td><td>${item.type}</td><td>${item.square}</td><td>${item.parkName}</td>`;
                                html += `<td><button class="btn btn-warning" onclick="showEditParkForm(${item.id})">Змінити</button></td>`;
                            }
                            html += '</tr>';
                        });
                        html += '</tbody></table>';
                        html += appendActionButtons(section);
                        $('#result').html(html);

                        // Додаємо подію для відповідної кнопки "Додати"
                        if (section === 'parks') {
                            $('#addParkButton').click(showAddParkForm);
                        } else if (section === 'plantings') {
                            $('#addPlantingButton').click(showAddPlantingForm);
                        } else if (section === 'fountains') {
                            $('#addFountainButton').click(showAddFountainForm);
                        } else if (section === 'pavilions') {
                            $('#addPavilionButton').click(showAddPavilionForm);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                        $('#result').html('<p>Помилка завантаження даних.</p>');
                    }
                });
            }

            $('#loadParks').click(function () { loadSection('parks'); });
            $('#loadPlantings').click(function () { loadSection('plantings'); });
            $('#loadFountains').click(function () { loadSection('fountains'); });
            $('#loadPavilions').click(function () { loadSection('pavilions'); });

            window.submitPark = function () {
                const name = $('#parkName').val();
                const square = $('#parkSquare').val();
                const location = $('#parkLocation').val();

                if (!name || !square || !location) {
                    alert("Будь ласка, заповніть усі поля.");
                    return;
                }

                $.ajax({
                    url: '@Url.Action("AddPark", "Parks")',
                    type: 'POST',
                    data: {
                        Name: name,
                        Square: square,
                        Location: location
                    },
                    success: function () {
                        alert("Парк успішно доданий!");
                        $('#addParkForm').remove();
                        loadSection('parks'); // Виклик функції завантаження парків
                    },
                    error: function (xhr, status, error) {
                        console.error("Помилка при додаванні парку: ", error);
                        alert("Не вдалося додати парк.");
                    }
                });
            };

            window.showEditParkForm = function (parkId) {
                $.ajax({
                    url: `@Url.Action("GetParkById", "Parks")?id=${parkId}`,  // Вызываем метод для получения парка по ID
                    type: 'GET',
                    success: function (data) {
                        $('#editParkForm').remove();
                        const formHtml = `
                            <div id="editParkForm" class="mt-3">
                                <h4>Редагувати парк</h4>
                                <input type="hidden" id="editParkId" value="${data.id}">
                                <input type="text" id="editParkName" class="form-control mb-2" value="${data.name}" placeholder="Назва парку">
                                <input type="number" id="editParkSquare" class="form-control mb-2" value="${data.square}" placeholder="Площа">
                                <input type="text" id="editParkLocation" class="form-control mb-2" value="${data.location}" placeholder="Локація">
                                <button class="btn btn-primary" onclick="submitEditPark()">Зберегти зміни</button>
                            </div>
                        `;
                        $('#result').append(formHtml);
                    },
                    error: function (xhr, status, error) {
                        console.error("Помилка отримання даних парку: ", error);
                        alert("Не вдалося завантажити дані парку.");
                    }
                });
            };

            // Функція для збереження змінених даних парку
            window.submitEditPark = function () {
                const parkId = $('#editParkId').val();
                const name = $('#editParkName').val();
                const square = $('#editParkSquare').val();
                const location = $('#editParkLocation').val();

                if (!parkId || !name || !square || !location) {
                    alert("Будь ласка, заповніть усі поля.");
                    return;
                }

                $.ajax({
                    url: '@Url.Action("ChangeParks", "Parks")',
                    type: 'POST',
                    data: {
                        ParkId: parkId,
                        Name: name,
                        Square: square,
                        Location: location
                    },
                    success: function () {
                        alert("Парк успішно змінено!");
                        $('#editParkForm').remove();
                        loadSection('parks');
                    },
                    error: function (xhr, status, error) {
                        console.error("Помилка при зміні парку: ", error);
                        alert("Не вдалося змінити парк.");
                    }
                });
            };


            window.submitPlanting = function () {
                const parkId = $('#parkId').val();
                const cultureType = $('#cultureType').val();
                const plantingName = $('#plantingName').val();
                const averageLifetime = $('#averageLifetime').val();
                const quantity = $('#quantity').val();

                if (!parkId || !cultureType || !plantingName || !averageLifetime || !quantity) {
                    alert("Будь ласка, заповніть усі поля.");
                    return;
                }

                $.ajax({
                    url: '@Url.Action("AddPlanting", "Parks")',
                    type: 'POST',
                    data: {
                        ParkId: parkId,
                        CultureType: cultureType,
                        Name: plantingName,
                        AverageLifetime: averageLifetime,
                        Quantity: quantity
                    },
                    success: function () {
                        alert("Насадження успішно додано!");
                        $('#addPlantingForm').remove();
                        loadSection('plantings'); // Виклик функції завантаження насаджень
                    },
                    error: function (xhr, status, error) {
                        console.error("Помилка при додаванні насадження: ", error);
                        alert("Не вдалося додати насадження.");
                    }
                });
            };

            window.showEditPlantingForm = function (plantingId) {
            $.ajax({
                url: `@Url.Action("GetPlantingById", "Parks")?id=${plantingId}`,  // Вызываем метод для получения насаждения по ID
                type: 'GET',
                success: function (data) {
                    $('#editPlantingForm').remove();
                    const formHtml = `
                        <div id="editPlantingForm" class="mt-3">
                            <h4>Редагувати насадження</h4>
                            <input type="hidden" id="editPlantingId" value="${data.id}">
                            <input type="number" id="editPlantingParkId" class="form-control mb-2" value="${data.parkId}" placeholder="ID парка">
                            <input type="text" id="editPlantingCultureType" class="form-control mb-2" value="${data.cultureType}" placeholder="Тип культури">
                            <input type="text" id="editPlantingName" class="form-control mb-2" value="${data.name}" placeholder="Ім'я насадження">
                            <input type="number" id="editPlantingAverageLifetime" class="form-control mb-2" value="${data.averageLifetime}" placeholder="Середня тривалість життя">
                            <input type="number" id="editPlantingQuantity" class="form-control mb-2" value="${data.quantity}" placeholder="Кількість">
                            <button class="btn btn-primary" onclick="submitEditPlanting()">Зберегти зміни</button>
                        </div>
                    `;
                    $('#result').append(formHtml);
                },
                error: function (xhr, status, error) {
                    console.error("Помилка отримання даних насадження: ", error);
                    alert("Не вдалося завантажити дані насадження.");
                }
            });
        };

        // Функція для збереження змінених даних насадження
        window.submitEditPlanting = function () {
            const plantingId = $('#editPlantingId').val();
            const parkId = $('#editPlantingParkId').val();
            const cultureType = $('#editPlantingCultureType').val();
            const name = $('#editPlantingName').val();
            const averageLifetime = $('#editPlantingAverageLifetime').val();
            const quantity = $('#editPlantingQuantity').val();

            if (!plantingId || !parkId || !cultureType || !name || !averageLifetime || !quantity) {
                alert("Будь ласка, заповніть усі поля.");
                return;
            }

            $.ajax({
                url: '@Url.Action("ChangePlanting", "Parks")',
                type: 'POST',
                data: {
                    PlantingId: plantingId,
                    ParkId: parkId,
                    CultureType: cultureType,
                    Name: name,
                    AverageLifetime: averageLifetime,
                    Quantity: quantity
                },
                success: function () {
                    alert("Насадження успішно змінено!");
                    $('#editPlantingForm').remove();
                    loadSection('plantings');
                },
                error: function (xhr, status, error) {
                    console.error("Помилка при зміні насадження: ", error);
                    alert("Не вдалося змінити насадження.");
                }
            });
        };

            window.submitFountain = function () {
                const parkId = $('#fountainParkId').val();
                const code = $('#fountainCode').val();
                const buildDate = $('#buildDate').val();
                const maxWaterConsumption = $('#maxWaterConsumption').val();
                const normalWaterConsumption = $('#normalWaterConsumption').val();
                const square = $('#fountainSquare').val();

                if (!parkId || !code || !buildDate || !maxWaterConsumption || !normalWaterConsumption || !square) {
                    alert("Будь ласка, заповніть усі поля.");
                    return;
                }

                $.ajax({
                    url: '@Url.Action("AddFountain", "Parks")',
                    type: 'POST',
                    data: {
                        ParkId: parkId,
                        Code: code,
                        BuildDate: buildDate,
                        MaxWaterConsumption: maxWaterConsumption,
                        NormalWaterConsumption: normalWaterConsumption,
                        Square: square
                    },
                    success: function () {
                        alert("Фонтан успішно доданий!");
                        $('#addFountainForm').remove();
                        loadSection('fountains'); // Виклик функції завантаження фонтанів
                    },
                    error: function (xhr, status, error) {
                        console.error("Помилка при додаванні фонтану: ", error);
                        alert("Не вдалося додати фонтан.");
                    }
                });
            };

            window.submitPavilion = function () {
                const parkId = $('#pavilionParkId').val();
                const name = $('#pavilionName').val();
                const type = $('#pavilionType').val();
                const square = $('#pavilionSquare').val();

                if (!parkId || !name || !type || !square) {
                    alert("Будь ласка, заповніть усі поля.");
                    return;
                }

                $.ajax({
                    url: '@Url.Action("AddPavilion", "Parks")',
                    type: 'POST',
                    data: {
                        ParkId: parkId,
                        Name: name,
                        Type: type,
                        Square: square
                    },
                    success: function () {
                        alert("Павільон успішно доданий!");
                        $('#addPavilionForm').remove();
                        loadSection('pavilions'); // Виклик функції завантаження павільонів
                    },
                    error: function (xhr, status, error) {
                        console.error("Помилка при додаванні павільону: ", error);
                        alert("Не вдалося додати павільон.");
                    }
                });
            };

        });
    </script>
}
